<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FINANÇAS</title>
  <link rel="stylesheet" type="text/css" href="style.css" media="screen" />
</head>

<body>
  <h2>CONTROLE DE FINANÇAS </h2>

  <div class="container">
    <h4>Saldo atual</h4>

    <h1 id="balance" class="balance">R$ 0.00</h1>

    <div class="inc-exp-container">
      <div>
        <h4>Lucros</h4>
        <p id="money-plus" class="money plus">+ R$0.00</p>
      </div>
      <div>
        <h4>Despesas</h4>
        <p id="money-minus" class="money minus">- R$0.00</p>
      </div>
    </div>

    <h3>Transações</h3>

    <ul id="transactions" class="transactions"></ul>

    <h3>Adicionar transação</h3>

    <form id="form">
      <div class="form-control">
        <label for="text">Nome</label>
        <input autofocus type="text" id="text" placeholder="Nome da transação" />
      </div>
      <div class="form-control">
        <label for="amount">Valor <br />
          <small>(Negativo - Despesas, Positivo - Lucros)</small>
        </label>
        <input type="number" id="amount" 3placeholder="Valor da transação" />
      </div>
      <button class="btn">Adicionar</button>
    </form>
  </div>

  <script>
    const transactionUL = document.querySelector('#transactions')
    const incomeDisplay = document.querySelector('#money-plus')
    const expenseDisplay = document.querySelector('#money-minus')
    const balanceDisplay = document.querySelector('#balance')
    const form = document.querySelector('#form')
    const inputTransactionName = document.querySelector('#text')
    const inputTransactionAmount = document.querySelector('#amount')

    const localStorageTransaction = JSON.parse(localStorage
      .getItem('transactions'))
    let transactions = localStorage
      .getItem('transactions') !== null ? localStorageTransaction : []

    const removeTransaction = ID => {
      transactions = transactions.filter(transaction =>
        transaction.id !== ID)
      updateLocalStorage()
      init()
    }

    const addTransactionDOM = transaction => {
      const operator = transaction.amount < 0 ? '-' : '+'
      const CSSClass = transaction.amount < 0 ? 'minus' : 'plus'
      const amountwithoutOperator = Math.abs(transaction.amount)
      const li = document.createElement('li')

      li.classList.add(CSSClass)
      li.innerHTML = ` ${transaction.name} 
      <span>${operator} R$ ${amountwithoutOperator} </span >
      <button class="delete-btn" onClick="removeTransaction(${transaction.id})">
        x
      </button>`
      transactionUL.append(li)
    }

    const updateBalanceValues = () => {
      const transactionAmounts = transactions
        .map(transaction => transaction.amount)
      const total = transactionAmounts.
        reduce((accumulator, transaction) => accumulator + transaction, 0)
        .toFixed(2)
      const income = transactionAmounts
        .filter(value => value > 0)
        .reduce((accumulator, value) => accumulator + value, 0)
        .toFixed(2)
      const expense = Math.abs(transactionAmounts.filter(value => value < 0)
        .reduce((accumulator, value) => accumulator + value, 0))
        .toFixed(2)
      balanceDisplay.textContent = `R$ ${total}`
      incomeDisplay.textContent = `R$ ${income}`
      expenseDisplay.textContent = `R$ ${expense}`
    }

    const init = () => {
      transactionUL.innerHTML = ''
      transactions.forEach(addTransactionDOM)
      updateBalanceValues()
    }
    init()

    const updateLocalStorage = () => {
      localStorage.setItem('transactions', JSON.stringify(transactions))
    }

    const genereteID = () => Math.round(Math.random() * 1000)

    form.addEventListener('submit', event => {
      event.preventDefault()

      const TransactionName = inputTransactionName.value.trim()
      const transactionAmounts = inputTransactionAmount.value.trim()

      if (inputTransactionName.value.trim() === '' || inputTransactionAmount.value.trim() === '') {
        alert('por favor, preencha os espaços vazios!!')
        return
      }
      const transaction = {
        id: genereteID(),
        name: TransactionName,
        amount: Number(transactionAmounts)
      }
      transactions.push(transaction)
      init()
      updateLocalStorage()

      inputTransactionName.value = ''
      inputTransactionAmount.value = ''
    })
  </script>
</body>

</html>